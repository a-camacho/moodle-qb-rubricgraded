define(["jquery"],function($){return{init:function(maxmark,elementname){var escapedelementname=elementname.replace(":","\\:"),escrubfillingname=escapedelementname.replace("-rubric","-rubfilling");$(document).ready(function(){var a=getMaxPoints(),b=calculatePoints();$("#totalPoints").html(b+"/"+a),$("#totalScoreDecimal").html(calculateDecimalTotal(b,a))}),$('input[name^="'+escapedelementname+'"]').change(function(){if(this.checked){var a=calculatePoints(),b=getMaxPoints(),c=calculateDecimalTotal(a,b);$("#totalPoints").html(a+"/"+b),$("#totalScoreDecimal").html(c),$("div#totalMark input").first().val(c),$("#"+escrubfillingname).val(generateFillingJSON())}}),$('textarea[name^="'+escapedelementname+'"]').change(function(){$("#"+escrubfillingname).val(generateFillingJSON())});var generateFillingJSON=function(){var a=[];return $("#rubric-"+escapedelementname+" input:checked").each(function(){var b=$(this).attr("id"),c=b.match(/criteria-([^-]+)/)[1],d=b.match(/levels-([^-]+)/)[1],e=$("#"+escapedelementname+"-criteria-"+c+"-remark").val(),f={};f.criterion=c,f.level=d,f.remark=e,a.push(f)}),JSON.stringify(a)},getMaxPoints=function(){var a=[];if($('td.last[id^="'+elementname+'-criteria"]').each(function(){var b=$(this).find("span.scorevalue").text();a.push(Number(b))}),a.length>0){for(var b=0,c=0;c<a.length;c++)b+=a[c]<<0;return b}return 0},calculatePoints=function(){var a=[],b=0;if($("#rubric-"+escapedelementname+" input:checked").each(function(){var b=$(this).attr("id"),c=b.slice(0,-11),d="#"+c+"-score",e=d.replace(":","\\:"),f=$(e).text();f=Number(f),a.push(f)}),a.length>0)for(var c=0;c<a.length;c++)b+=a[c]<<0;return b},calculateDecimalTotal=function(totalPoints,maxPoints){var totalRounded,totalDecimal,maximumMark=maxmark;return totalDecimal=totalPoints>0?eval(totalPoints/maxPoints):0,totalRounded=totalDecimal*maximumMark,totalRounded=totalRounded.toFixed(2)}}}});